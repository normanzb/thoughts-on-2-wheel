<article class="post">
    <div class="inner">
        <h1>{{title}}</h1>
        <span class="date">\ {{date}} \</span>
        {{{contents}}}
    </div>
    <script>
    (function(){
        'use strict';
        var script = document.scripts[document.scripts.length - 1];
        var container = script.parentNode;

        /* TODO: auto wrap from server side */
        function wrapElement(query, wrapperClass, callback){
            var imgs = container.querySelectorAll(query);
            var img;
            var wrap;
            for(var l = imgs.length; l--; ) {
                img = imgs[l];
                wrap = document.createElement('div');
                wrap.classList.add(wrapperClass);
                img.parentNode.insertBefore(wrap,img);
                wrap.appendChild(img);
                if (callback) {
                    callback(wrap, img);
                }
            }
            return wrap;
        }
        
        wrapElement('img', 'image-container', function(wrap, el){
            wrap.setAttribute('title', el.getAttribute('alt'));
        });
        wrapElement(':scope > .inner > iframe', 'iframe-container', function(wrap){
            wrap.addEventListener('click', function(){
                wrap.classList.add('activated');
            })
        });

        var requestAnimationFrame = window.requestAnimationFrame;
        var cancelAnimationFrame = window.cancelAnimationFrame;

        (function() {
            var lastTime = 0;
            var vendors = ['ms', 'moz', 'webkit', 'o'];
            for(var x = 0; x < vendors.length && !requestAnimationFrame; ++x) {
                requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
                cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] || 
                    window[vendors[x]+'CancelRequestAnimationFrame'];
            }
         
            if (!requestAnimationFrame)
                requestAnimationFrame = function(callback) {
                    var currTime = new Date().getTime();
                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                    var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
                      timeToCall);
                    lastTime = currTime + timeToCall;
                    return id;
                };
         
            if (!cancelAnimationFrame)
                cancelAnimationFrame = function(id) {
                    clearTimeout(id);
                };
        }());

        // columns scroll handling
        var articleScrollingInfo = window.articleScrollingInfo = {
            handling: false
        };
        var elContent = document.querySelector('.content');
        var obj = {
            x: container.scrollLeft * 1
        };

        container.addEventListener('wheel', function(event){
            var value = event.deltaY; 
            // value = (event.deltaY/Math.abs(event.deltaY)) >> 0; 
            var dy = Math.abs(event.deltaY);
            var dx = Math.abs(event.deltaX);
            var doNotBlock = false;

            if (dy > dx) {
                value = event.deltaY;
            }
            else {
                value = event.deltaX;
                doNotBlock = true;
            }
            var boundingRect = container.getBoundingClientRect();

            if (
                doNotBlock === false && 
                value > 0 && 
                Math.ceil(container.scrollLeft + container.offsetWidth) >= container.scrollWidth
            ) {
                articleScrollingInfo.handling = false;
                return;
            }

            if (
                doNotBlock === false && (
                    boundingRect.top < container.offsetTop || 
                    (value < 0 && container.scrollLeft <= 0)
                )
            ) {
                articleScrollingInfo.handling = false;
                return;
            }

            articleScrollingInfo.handling = true;

            obj.x += value * 10;

            if (obj.x > container.scrollWidth - container.offsetWidth) {
                obj.x = container.scrollWidth - container.offsetWidth;
            }
            else if (obj.x < 0) {
                obj.x = 0;
            }

            event.preventDefault();
            event.stopPropagation();
        }, {passive: false, capture: false});

        requestAnimationFrame(function loop(){
            if (container.scrollLeft !== obj.x) {
                container.scrollLeft += Math.ceil((obj.x - container.scrollLeft) / 2);
            }
            requestAnimationFrame(loop);
        });
    })();
    </script>
</article>